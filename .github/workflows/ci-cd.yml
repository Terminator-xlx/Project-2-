name: Python CI/CD Pipeline 
 
on: 
  push: 
    branches: [ main, master ] 
  pull_request: 
    branches: [ main, master ] 
 
jobs: 
  test: 
    runs-on: windows-latest 
 
    steps: 
    - name: Checkout code 
      uses: actions/checkout@v3 
 
    - name: Set up Python 
      uses: actions/setup-python@v4 
      with: 
        python-version: '3.10' 
 
    - name: Install dependencies 
        python -m pip install --upgrade pip 
        pip install -r requirements.txt 
        pip install pytest pytest-cov 
 
    - name: Run unit tests 
      env: 
        DATABASE_URL: sqlite:///:memory: 
        SECRET_KEY: test-secret-key 
        python -m pytest tests/unit/ -v 
 
    - name: Run integration tests 
      env: 
        DATABASE_URL: sqlite:///test.db 
        SECRET_KEY: test-secret-key 
        python -m pytest tests/integration/ -v 
 
    - name: Run system tests 
      env: 
        DATABASE_URL: sqlite:///system_test.db 
        SECRET_KEY: test-secret-key 
        python -m pytest tests/system/ -v 
 
    - name: Test coverage 
        python -m pytest tests/ --cov=app --cov-report=xml 
 
  build: 
    needs: test 
    runs-on: ubuntu-latest 
    if: github.ref == 'refs/heads/main' 
 
    steps: 
    - name: Checkout code 
      uses: actions/checkout@v3 
 
    - name: Set up Docker Buildx 
      uses: docker/setup-buildx-action@v2 
 
    - name: Build Docker image 
        docker build -t flask-app:latest . 
